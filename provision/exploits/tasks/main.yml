---
- name: Import exploits list
  include_vars: ../exploits/list.yml

- name: Make exploits folder
  become: yes
  file: path=/exploits/ state=directory owner=vagrant mode=0755

- name: Copy exploits to VM
  copy: src=../exploits/{{ item.key }} dest=/exploits/{{ item.key }} owner=vagrant mode=0777
  with_dict: "{{ exploits }}"

- name: Copy gdb script
  copy: src=../attachgdb.sh dest=/home/vagrant/attachgdb.sh owner=vagrant mode=0777
  
- name: Configure xinetd
  become: yes
  template: src=xinetd.j2 dest=/etc/xinetd.d/{{ item.key }}
  with_dict: "{{ exploits }}"

- name: Configure services
  become: yes
  lineinfile: dest=/etc/services line="{{ item.key }}		{{ item.value.port }}/tcp"
  with_dict: "{{ exploits }}"

- name: Restart xinetd
  become: yes
  service: name=xinetd state=restarted